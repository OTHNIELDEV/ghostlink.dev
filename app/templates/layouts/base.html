<!DOCTYPE html>
<html lang="{{ ui_language_resolved if ui_language_resolved is defined else 'en' }}" class="dark">
{% set tr = i18n if i18n is defined else {} %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ tr.get('base_title', 'GhostLink | AI Optimization Platform') }}</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            850: '#151F32',
                            900: '#0f172a',
                            950: '#020617',
                        },
                        emerald: {
                            450: '#10b981', // Custom emerald
                        }
                    }
                }
            }
        }
    </script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"
        integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC"
        crossorigin="anonymous"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Prism.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>

    <style>
        body {
            background-color: #0f172a;
            /* Slate 900 */
            color: #f8fafc;
            /* Slate 50 */
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gradient-text {
            background: linear-gradient(to right, #34d399, #818cf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
    </style>
    {% block head %}{% endblock %}
</head>

<body class="antialiased min-h-screen flex flex-col font-sans">

    <div x-data="globalState()" @ghostlink-toast.window="openToast($event.detail.message)">
        {% include 'components/navbar.html' with context %}

        <main class="flex-grow">
            {% block content %}{% endblock %}
        </main>

        <footer class="border-t border-slate-800 bg-slate-950 pt-16 pb-8 mt-12">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mb-12">
                    <!-- Brand Column -->
                    <div class="col-span-2 md:col-span-1">
                        <a href="/" class="flex items-center gap-2 mb-4 group">
                            <div
                                class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-indigo-500 flex items-center justify-center text-white font-bold text-lg shadow-lg group-hover:shadow-emerald-500/20 transition-all">
                                G</div>
                            <span
                                class="font-bold text-xl tracking-tight text-white group-hover:text-emerald-400 transition-colors">GhostLink</span>
                        </a>
                        <p class="text-slate-400 text-sm mb-6">
                            {{ tr.get('footer_tagline', 'The AI Visibility Engine for the Modern Web.') }}
                        </p>
                        <div class="flex gap-4">
                            <!-- Social Icons -->
                            <a href="/footer/community" class="text-slate-400 hover:text-white transition-colors"><svg
                                    class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zl-1.161 17.52h1.833L7.084 4.126H5.117z" />
                                </svg></a>
                            <a href="/footer/api-reference"
                                class="text-slate-400 hover:text-white transition-colors"><svg class="w-5 h-5"
                                    fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd"
                                        d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                                        clip-rule="evenodd" />
                                </svg></a>
                            <a href="/footer/contact" class="text-slate-400 hover:text-white transition-colors"><svg
                                    class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M20.317 4.37a19.791 19.791 0 00-4.885-1.515.074.074 0 00-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 00-5.487 0 12.64 12.64 0 00-.617-1.25.077.077 0 00-.079-.037A19.736 19.736 0 003.677 4.37a.07.07 0 00-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 00.031.057 19.9 19.9 0 005.993 3.03.078.078 0 00.084-.028 14.09 14.09 0 001.226-1.994.076.076 0 00-.041-.106 13.107 13.107 0 01-1.872-.892.077.077 0 01-.008-.128 10.2 10.2 0 00.372-.292.074.074 0 01.077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 01.078.01c.12.098.246.198.373.292a.077.077 0 01-.006.127 12.299 12.299 0 01-1.873.892.077.077 0 00-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 00.084.028 19.839 19.839 0 006.002-3.03.077.077 0 00.032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 00-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.419 0 1.334-.956 2.419-2.157 2.419z" />
                                </svg></a>
                        </div>
                    </div>

                    <!-- Product Column -->
                    <div>
                        <h3 class="font-semibold text-white mb-4">{{ tr.get('footer_product', 'Product') }}</h3>
                        <ul class="space-y-2 text-sm text-slate-400">
                            <li><a href="/features" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_features', 'Features') }}</a></li>
                            <li><a href="/footer/pricing" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_pricing', 'Pricing') }}</a></li>
                            <li><a href="/footer/integrations" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_integrations', 'Integrations') }}</a></li>
                            <li><a href="/footer/changelog" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_changelog', 'Changelog') }}</a></li>
                            <li><a href="/footer/documentation" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_docs',
                                    'Documentation') }}</a></li>
                        </ul>
                    </div>

                    <!-- Resources Column -->
                    <div>
                        <h3 class="font-semibold text-white mb-4">{{ tr.get('footer_resources', 'Resources') }}</h3>
                        <ul class="space-y-2 text-sm text-slate-400">
                            <li><a href="/footer/blog" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_blog',
                                    'Blog') }}</a></li>
                            <li><a href="/footer/community" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_community', 'Community') }}</a></li>
                            <li><a href="/footer/help-center" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_help',
                                    'Help Center') }}</a></li>
                            <li><a href="/footer/api-reference" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_api',
                                    'API Reference') }}</a></li>
                            <li>
                                <a href="/footer/status"
                                    class="flex items-center gap-2 hover:text-emerald-400 transition-colors">
                                    <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                                    {{ tr.get('footer_status', 'System Status') }}
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Company Column -->
                    <div>
                        <h3 class="font-semibold text-white mb-4">{{ tr.get('footer_company', 'Company') }}</h3>
                        <ul class="space-y-2 text-sm text-slate-400">
                            <li><a href="/footer/about" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_about',
                                    'About Us') }}</a></li>
                            <li><a href="/footer/careers" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_careers',
                                    'Careers') }}</a></li>
                            <li><a href="/footer/legal" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_legal',
                                    'Legal') }}</a></li>
                            <li><a href="/footer/contact" class="hover:text-emerald-400 transition-colors">{{
                                    tr.get('footer_contact',
                                    'Contact') }}</a></li>
                        </ul>
                    </div>
                </div>

                <div
                    class="border-t border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                    <p class="text-sm text-slate-500">&copy; 2026 GhostLink. {{ tr.get('base_footer_rights', 'All rights
                        reserved.') }}</p>
                    <div class="flex items-center gap-6 text-sm text-slate-500">
                        <a href="/footer/privacy" class="hover:text-slate-300 transition-colors">{{
                            tr.get('footer_privacy', 'Privacy
                            Policy') }}</a>
                        <a href="/footer/terms" class="hover:text-slate-300 transition-colors">{{ tr.get('footer_terms',
                            'Terms of
                            Service') }}</a>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Global Toast Notification -->
        <div x-show="isToastVisible" x-transition.opacity.duration.300ms
            class="fixed bottom-4 right-4 bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center gap-2"
            style="display: none;">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span x-text="toastMessage"></span>
        </div>
    </div>

    <!-- Global Scripts -->
    <script>
        function globalState() {
            return {
                isToastVisible: false,
                toastMessage: '',
                toastTimeout: null,
                openToast(message) {
                    this.toastMessage = message;
                    this.isToastVisible = true;
                    if (this.toastTimeout) {
                        clearTimeout(this.toastTimeout);
                    }
                    this.toastTimeout = setTimeout(() => {
                        this.isToastVisible = false;
                    }, 2200);
                }
            };
        }

        function emitToast(message) {
            window.dispatchEvent(new CustomEvent('ghostlink-toast', {
                detail: {
                    message
                }
            }));
        }

        function extractErrorMessageFromXhr(xhr) {
            if (!xhr) return null;
            const raw = xhr.responseText || "";
            if (!raw) {
                return xhr.status ? `Request failed (${xhr.status})` : "Request failed";
            }
            try {
                const parsed = JSON.parse(raw);
                if (typeof parsed.detail === 'string' && parsed.detail.trim()) return parsed.detail;
                if (parsed.detail && typeof parsed.detail === 'object') {
                    if (typeof parsed.detail.message === 'string' && parsed.detail.message.trim()) {
                        return parsed.detail.message;
                    }
                    return "Request failed due to policy validation.";
                }
                if (typeof parsed.message === 'string' && parsed.message.trim()) return parsed.message;
            } catch (_) {
                // Ignore parse errors and fallback.
            }
            return raw.slice(0, 180);
        }

        function copyScript(scriptUrl) {
            const resolvedUrl = new URL(scriptUrl, window.location.origin).toString();
            const scriptTag = `<script async src="${resolvedUrl}"><\/script>`;

            const fallbackCopy = () => {
                const textarea = document.createElement('textarea');
                textarea.value = scriptTag;
                textarea.setAttribute('readonly', '');
                textarea.style.position = 'fixed';
                textarea.style.left = '-9999px';
                document.body.appendChild(textarea);
                textarea.select();
                textarea.setSelectionRange(0, textarea.value.length);
                document.execCommand('copy');
                document.body.removeChild(textarea);
            };

            const onSuccess = () => {
                emitToast('Script tag copied');
            };

            const onFailure = () => {
                emitToast('Copy failed. Please copy manually.');
                window.prompt('Copy script tag', scriptTag);
            };

            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(scriptTag)
                    .then(onSuccess)
                    .catch(() => {
                        try {
                            fallbackCopy();
                            onSuccess();
                        } catch (_) {
                            onFailure();
                        }
                    });
                return;
            }

            try {
                fallbackCopy();
                onSuccess();
            } catch (_) {
                onFailure();
            }
        }

        document.addEventListener('htmx:responseError', (event) => {
            const msg = extractErrorMessageFromXhr(event?.detail?.xhr);
            emitToast(msg || 'Request failed');
        });

        document.addEventListener('htmx:sendError', () => {
            emitToast('Network error. Please retry.');
        });
    </script>

    <!-- Upgrade Modal -->
    <div x-data="{ open: false }" x-on:open-upgrade-modal.window="open = true" x-show="open" style="display: none;"
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm"
        x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">

        <div class="bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl max-w-md w-full p-6 relative"
            x-show="open" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95 translate-y-4"
            x-transition:enter-end="opacity-100 scale-100 translate-y-0"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100 translate-y-0"
            x-transition:leave-end="opacity-0 scale-95 translate-y-4" @click.away="open = false">

            <button @click="open = false"
                class="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>

            <div class="text-center mb-6">
                <div class="w-12 h-12 rounded-full bg-indigo-500/10 flex items-center justify-center mx-auto mb-4">
                    <svg class="w-6 h-6 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">{{ tr.get('modal_upgrade_title', 'Unlock Unlimited
                    Potential') }}</h3>
                <p class="text-slate-400 text-sm">{{ tr.get('modal_upgrade_desc', 'You have reached the limits of your
                    current plan. Upgrade to Pro to add more sites and unlock real-time indexing.') }}</p>
            </div>

            <div class="space-y-3 mb-6">
                <div class="flex items-center gap-3 text-sm text-slate-300">
                    <svg class="w-5 h-5 text-emerald-500 flex-shrink-0" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>Up to 20 Active Sites</span>
                </div>
                <div class="flex items-center gap-3 text-sm text-slate-300">
                    <svg class="w-5 h-5 text-emerald-500 flex-shrink-0" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>Daily Real-time Indexing</span>
                </div>
                <div class="flex items-center gap-3 text-sm text-slate-300">
                    <svg class="w-5 h-5 text-emerald-500 flex-shrink-0" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>Detailed Bot Analytics</span>
                </div>
            </div>

            <a href="/pricing?upgrade=true"
                class="block w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-500 text-white text-center font-medium rounded-lg transition-colors shadow-lg shadow-indigo-500/20">
                {{ tr.get('modal_upgrade_cta', 'Upgrade to Pro') }}
            </a>
            <button @click="open = false"
                class="block w-full py-3 mt-2 text-slate-400 hover:text-white text-sm transition-colors">
                {{ tr.get('modal_upgrade_cancel', 'Maybe Later') }}
            </button>
        </div>
    </div>

</body>

<script>
    // Listen for 403 errors with specific message to trigger upgrade modal
    document.addEventListener('htmx:responseError', (event) => {
        const xhr = event.detail.xhr;
        if (xhr.status === 403) {
            const msg = extractErrorMessageFromXhr(xhr) || "";
            if (msg.includes("Link limit reached") || msg.includes("Upgrade your plan")) {
                window.dispatchEvent(new CustomEvent('open-upgrade-modal'));
                // Optional: Prevent toast if you only want the modal
                // event.stopPropagation(); 
            }
        }
    });
</script>

</html>