{% extends "layouts/base.html" %}

{% block content %}
<div class="flex h-[calc(100vh-64px)] overflow-hidden">
    {% include 'components/sidebar.html' %}

    <div class="flex-1 overflow-auto p-8 bg-slate-950">
        <div class="max-w-5xl mx-auto space-y-8">
            <div>
                <h1 class="text-3xl font-bold text-white">GhostLink 통합 적용 가이드</h1>
                <p class="text-slate-400 mt-2">
                    고객 홈페이지에 GhostLink를 물리적으로 적용하는 권장 절차입니다.
                </p>
            </div>

            <div class="glass border border-slate-700/60 rounded-2xl p-6">
                <h2 class="text-lg font-semibold text-white mb-4">1) 스크립트 1회 설치</h2>
                {% if bridge_script_url %}
                <div class="rounded-xl border border-slate-700/70 bg-slate-900/60 p-4 mb-4">
                    <div class="text-xs uppercase tracking-wider text-slate-400 mb-2">아래 태그를 한 번만 삽입</div>
                    <pre class="text-xs text-cyan-200 overflow-x-auto"><code>&lt;script async src="{{ bridge_script_url }}"&gt;&lt;/script&gt;</code></pre>
                    <button
                        class="mt-3 px-3 py-1.5 rounded-md text-xs font-semibold bg-cyan-500/20 text-cyan-200 border border-cyan-500/30 hover:bg-cyan-500/30 transition-colors"
                        onclick="copyScript('{{ bridge_script_url }}')">
                        스크립트 태그 복사
                    </button>
                </div>
                {% else %}
                <div class="rounded-xl border border-amber-500/30 bg-amber-500/10 p-4 text-sm text-amber-200">
                    먼저 사이트를 등록하면 사이트 전용 script URL이 생성됩니다.
                </div>
                {% endif %}
                <p class="text-sm text-slate-300">
                    원칙: 스크립트는 페이지마다 중복 삽입하지 말고, 사이트 공통 레이아웃에서 한 번만 로드하세요.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="glass border border-emerald-500/30 rounded-xl p-5">
                    <div class="text-xs uppercase tracking-wider text-emerald-300 mb-2">권장</div>
                    <h3 class="text-sm font-semibold text-white">공통 템플릿 / GTM</h3>
                    <p class="text-xs text-slate-300 mt-2 leading-relaxed">
                        WordPress, Shopify, Next.js, 사내 CMS처럼 템플릿 개념이 있으면 공통 head에 삽입하는 방식이 가장 안전합니다.
                    </p>
                </div>
                <div class="glass border border-slate-700/70 rounded-xl p-5">
                    <div class="text-xs uppercase tracking-wider text-slate-400 mb-2">정적 웹사이트</div>
                    <h3 class="text-sm font-semibold text-white">index.html 삽입</h3>
                    <p class="text-xs text-slate-300 mt-2 leading-relaxed">
                        정적 사이트(단일 배포 HTML)라면 `index.html`의 `&lt;/head&gt;` 직전에 삽입해도 됩니다.
                    </p>
                </div>
                <div class="glass border border-slate-700/70 rounded-xl p-5">
                    <div class="text-xs uppercase tracking-wider text-slate-400 mb-2">고급 운영</div>
                    <h3 class="text-sm font-semibold text-white">Edge Deployments API</h3>
                    <p class="text-xs text-slate-300 mt-2 leading-relaxed">
                        환경별(staging/production) 자동 배포가 필요하면 Edge artifact/deployment API를 사용하세요.
                    </p>
                </div>
            </div>

            <div class="glass border border-slate-700/60 rounded-2xl p-6">
                <h2 class="text-lg font-semibold text-white mb-4">2) 언제 index.html이 맞고, 언제 아닌가</h2>
                <div class="space-y-3 text-sm text-slate-300">
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3">
                        <div class="font-semibold text-emerald-300 mb-1">index.html 적용이 적합한 경우</div>
                        <div>정적 사이트, 빌드 결과가 단일 HTML 엔트리, 페이지 공통 레이아웃이 사실상 index.html 하나인 경우.</div>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3">
                        <div class="font-semibold text-amber-300 mb-1">index.html 단독 적용이 부적합한 경우</div>
                        <div>멀티 템플릿 CMS, SSR 프레임워크, 마이크로 프론트엔드, 다중 도메인/서브도메인 운용 환경.</div>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3">
                        <div class="font-semibold text-cyan-300 mb-1">실무 권장 해답</div>
                        <div>가능하면 템플릿 또는 태그매니저(GTM)에서 공통 배포하고, 배포 후 GhostLink에서 7일 이벤트 감지로 검증합니다.</div>
                    </div>
                </div>
            </div>

            <div class="glass border border-slate-700/60 rounded-2xl p-6">
                <h2 class="text-lg font-semibold text-white mb-4">3) 검증 체크리스트</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm">
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        스크립트 요청(7일):
                        <span class="text-white font-semibold">{{ installation_status.script_request_count_7d }}</span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        브릿지 이벤트(7일):
                        <span class="text-white font-semibold">{{ installation_status.bridge_event_count_7d }}</span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        원본 이벤트 총계(7일):
                        <span class="text-white font-semibold">{{ installation_status.raw_event_total_7d }}</span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        수집 성공률(7일):
                        <span class="text-white font-semibold">
                            {% if installation_status.raw_event_accept_rate_pct_7d is not none %}
                            {{ installation_status.raw_event_accept_rate_pct_7d }}%
                            {% else %}
                            -
                            {% endif %}
                        </span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        드롭 이벤트(7일):
                        <span class="text-white font-semibold">{{ installation_status.raw_event_dropped_7d }}</span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        배치 인제스트 비중(7일):
                        <span class="text-white font-semibold">
                            {% if installation_status.batch_source_share_pct_7d is not none %}
                            {{ installation_status.batch_source_share_pct_7d }}%
                            {% else %}
                            -
                            {% endif %}
                        </span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        재시도 발생 이벤트(7일):
                        <span class="text-white font-semibold">{{ installation_status.raw_event_retry_seen_7d }}</span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        재시도 발생 비중(7일):
                        <span class="text-white font-semibold">
                            {% if installation_status.raw_event_retry_seen_share_pct_7d is not none %}
                            {{ installation_status.raw_event_retry_seen_share_pct_7d }}%
                            {% else %}
                            -
                            {% endif %}
                        </span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        재시도 대기 이벤트(7일):
                        <span class="text-white font-semibold">{{ installation_status.raw_event_retry_pending_7d }}</span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        재시도 소진 드롭(7일):
                        <span class="text-white font-semibold">{{ installation_status.raw_event_retry_exhausted_7d }}</span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        상태:
                        <span class="font-semibold {% if installation_status.detected %}text-emerald-300{% else %}text-amber-300{% endif %}">
                            {% if installation_status.detected %}감지됨{% else %}미감지{% endif %}
                        </span>
                    </div>
                    <div class="rounded-lg border border-slate-700/70 bg-slate-900/50 p-3 text-slate-300">
                        다음 단계:
                        <a href="/proof?org_id={{ org_id }}" class="text-cyan-300 hover:text-cyan-200">프루프 센터 실행</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
