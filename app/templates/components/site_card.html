<div class="group relative bg-slate-900 border border-slate-700/50 hover:border-emerald-500/50 rounded-xl p-5 transition-all duration-300 hover:shadow-lg hover:shadow-emerald-900/10"
    id="site-card-{{ site.id }}" {% if site.status=='processing' or site.status=='pending' %}
    hx-get="/api/sites/{{ site.id }}/card" hx-trigger="every 2s" hx-swap="outerHTML" {% endif %}>

    <!-- Header: Status & Actions -->
    <div class="flex justify-between items-start mb-4">
        <div class="flex items-center gap-2">
            {% if site.status == 'active' or site.status == 'completed' %}
            <span class="flex h-2.5 w-2.5 relative">
                <span
                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
            </span>
            <span class="text-xs font-medium text-emerald-400 uppercase tracking-wider">Active</span>
            {% elif site.status == 'processing' or site.status == 'pending' %}
            <span class="flex h-2.5 w-2.5 relative">
                <span
                    class="animate-spin absolute inline-flex h-full w-full rounded-full border-2 border-amber-400 border-t-transparent"></span>
            </span>
            <span class="text-xs font-medium text-amber-400 uppercase tracking-wider">Scanning...</span>
            {% elif site.status == 'failed' %}
            <span class="h-2.5 w-2.5 rounded-full bg-red-500"></span>
            <span class="text-xs font-medium text-red-400 uppercase tracking-wider">Failed</span>
            {% else %}
            <span class="h-2.5 w-2.5 rounded-full bg-slate-500"></span>
            <span class="text-xs font-medium text-slate-400 uppercase tracking-wider">Pending</span>
            {% endif %}
        </div>

        <div class="flex gap-1 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition-opacity">
            <button onclick="openJsonEditor('{{ site.id }}', this.getAttribute('data-json'))"
                data-json="{{ site.json_ld_content | replace('"', ' &quot;') }}"
                class="p-1.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors"
                title="Edit JSON-LD">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                    </path>
                </svg>
            </button>
            <button hx-delete="/api/sites/{{ site.id }}" hx-target="#site-card-{{ site.id }}" hx-swap="outerHTML"
                hx-confirm="Are you sure you want to delete this site?"
                class="p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-800 rounded-lg transition-colors"
                title="Delete Site">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                    </path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Main Info -->
    <div class="mb-4">
        <h3 class="text-lg font-semibold text-white truncate mb-1" title="{{ site.url }}">{{ site.url |
            replace('https://', '') | replace('http://', '') | replace('www.', '') }}</h3>
        <a href="{{ site.url }}" target="_blank"
            class="text-xs text-slate-500 hover:text-emerald-400 transition-colors flex items-center gap-1 truncate">
            {{ site.url }}
            <svg class="w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
        </a>
    </div>

    <!-- Stats Row -->
    <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="bg-slate-950/50 rounded-lg p-3 border border-slate-800">
            <div class="text-[10px] text-slate-500 uppercase font-semibold mb-1">AI Score</div>
            <div
                class="text-2xl font-bold {{ 'text-emerald-400' if site.ai_score >= 80 else 'text-amber-400' if site.ai_score >= 50 else 'text-red-400' }}">
                {{ site.ai_score }}<span class="text-xs text-slate-600 font-normal">/100</span>
            </div>
        </div>
        <div class="bg-slate-950/50 rounded-lg p-3 border border-slate-800">
            <div class="text-[10px] text-slate-500 uppercase font-semibold mb-1">Schema</div>
            <div class="text-sm font-medium text-slate-300 truncate" title="{{ site.schema_type }}">
                {{ site.schema_type }}
            </div>
        </div>
    </div>

    <!-- Error Message -->
    {% if site.error_msg %}
    <div class="mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg">
        <p class="text-xs text-red-400 break-words">{{ site.error_msg }}</p>
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="grid grid-cols-2 gap-2">
        <a href="/report/{{ site.id }}"
            class="flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-emerald-500/10 text-emerald-400 text-sm font-medium border border-emerald-500/20 hover:bg-emerald-500/20 transition-all">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                </path>
            </svg>
            Analytics
        </a>
        <button hx-post="/api/sites/{{ site.id }}/generate" hx-target="#site-card-{{ site.id }}" hx-swap="outerHTML"
            class="flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-slate-800 text-slate-300 text-sm font-medium border border-slate-700 hover:bg-slate-700 transition-all">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                </path>
            </svg>
            Rescan
        </button>
    </div>

    <!-- Footer Info -->
    <div class="mt-3 flex justify-between items-center text-[10px] text-slate-600">
        <span>Updated {{ site.updated_at.strftime('%Y-%m-%d') }}</span>
        {% if site.script_id %}
        <span class="font-mono bg-slate-800 px-1.5 py-0.5 rounded text-slate-500 cursor-pointer hover:text-emerald-400"
            onclick="copyScript('{{ request.base_url }}api/bridge/{{ site.script_id }}.js')"
            title="Click to copy script tag">
            ID: {{ site.script_id[:6] }}...
        </span>
        {% endif %}
    </div>
</div>
